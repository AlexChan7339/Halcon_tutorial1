# 4-函数封装

```c
* 读取图像
read_image (Image, 'monkey')
* 阈值分割
threshold (Image, Region, 130, 255)
* 填充
fill_up (Region, RegionFillUp)
* 打散
connection (RegionFillUp, ConnectedRegions)
* 筛选
select_shape (ConnectedRegions, SelectedRegions, 'area', 'and', 800, 1000)
* 腐蚀（去除杂质）
erosion_circle (SelectedRegions, RegionErosion, 3.5)
* 膨胀（去除杂质）
dilation_circle (RegionErosion, RegionDilation, 3.5)
* 合并
union1 (RegionDilation, RegionUnion)
```

# 步骤

1. 选中`阈值分割` 到 `合并` 部分， 右击选择`创建新函数`；

   <img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202508231631741.png" alt="image-20250823163152605" style="zoom:50%;" />

   1.  跳出的页面中，`名称`输入：`MyFunction`;

   2. 点击参数，修改输出

      <img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202508231634765.png" alt="image-20250823163412659" style="zoom:33%;" />

   3. 输出删除前面6个变量，只保留`RegionUnion`

2. 点击应用 和 确定

> 此时代码会变成：
>
> ```c
> * 读取图像
> read_image (Image, 'monkey')
> MyFunction (Image, RegionUnion)
> ```

3. 点击右键，选择`在新窗口中选择函数`，此时能看到我们刚刚封装的函数

   ```c
   * 阈值分割
   threshold (Image, Region, 130, 255)
   * 填充
   fill_up (Region, RegionFillUp)
   * 打散
   connection (RegionFillUp, ConnectedRegions)
   * 筛选
   select_shape (ConnectedRegions, SelectedRegions, 'area', 'and', 800, 1000)
   * 腐蚀（去除杂质）
   erosion_circle (SelectedRegions, RegionErosion, 3.5)
   * 膨胀（去除杂质）
   dilation_circle (RegionErosion, RegionDilation, 3.5)
   * 合并
   union1 (RegionDilation, RegionUnion)
   return ()
   ```

   我们在封装代码里加上一个新的需求：输出眼球的面积：

   ```c
   * 阈值分割
   threshold (Image, Region, 130, 255)
   * 填充
   fill_up (Region, RegionFillUp)
   * 打散
   connection (RegionFillUp, ConnectedRegions)
   * 筛选
   select_shape (ConnectedRegions, SelectedRegions, 'area', 'and', 800, 1000)
   * 腐蚀（去除杂质）
   erosion_circle (SelectedRegions, RegionErosion, 3.5)
   * 膨胀（去除杂质）
   dilation_circle (RegionErosion, RegionDilation, 3.5)
   * 合并
   union1 (RegionDilation, RegionUnion)
       
   * 获取眼球区域的中心点和面积
   area_center	(RegionUnion, Area, Row, Column)
   return ()
   ```

   点击右上角`编辑当前函数的接口和文档`，将`Area`增加为`控制变量`，此时封装函数也会发生变化：`MyFunction (Image, RegionUnion, Area)`

   ![image-20250823170316110](https://typora3.oss-cn-shanghai.aliyuncs.com/202508231703532.png)

   运行时**会看到控制变量区域输出面积**

   ![屏幕截图 2025-08-23 175952](https://typora3.oss-cn-shanghai.aliyuncs.com/202508231800730.png)

   > **注意**
   >
   > 由于`Area`是控制变量，不是图像变量（运行时它只会出现在控制百年来区域，不会出现在图像变量区域）
   >
   > ![屏幕截图 2025-08-23 170611](https://typora3.oss-cn-shanghai.aliyuncs.com/202508231707225.png)

